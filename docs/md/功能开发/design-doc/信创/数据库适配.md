## SQL 标准

SQL 的第一个标准是 1986 年 10 月由美国国家标准化组织 (ANSI) 公布的 ANSIX3.135-1986 数据库语言 SQL，简称 SQL-86，1987 年国际标准化组织 (ISO) 也通过了这一标准。以后通过对 SQL-86 的不断修改和完善，于 1989 年第二次公布了 SQL 标准 ISO/IEC 9075-1989(E)，即 SQL-89。1992 年又公布了 SQL 标准 ISO/IEC 9075:1992，即 SQL-92。1999 年公布了 ISO/IEC 9075:1999，即 SQL-3 (也称 SQL-99)。之后在 2003 年公布了 ISO/IEC 9075:2003，即 SQL:2003；在 2008 年公布了 ISO/IEC 9075:2008，即 SQL:2008；在 2011 年公布了 ISO/IEC 9075:2011，即 SQL:2011。由于 SQL 标准的内容越来越庞杂，绝大多数情况下，说起 SQL 符合程度，其实是指 SQL-92 中最核心的部分，从 SQL-99 后不再对标准符合程度进行分级，而是改成了核心兼容性和特性兼容性。

目前，世界上大型的著名数据库管理系统均支持 SQL 语言，如 Oracle、Sybase、SQL Server、DB2 等。在未来相当长的时间里，SQL 仍将是数据库领域以至信息领域中数据处理的主流语言之一

由于不同的数据库产品，大都按自己产品的特点对 SQL 语言进行了扩充，很难完全符合 SQL 标准

<br>

## 数据库区别
最受欢迎的数据库前4名是 Oracle、MySQL、SQL Server、 PostgreSQL，在信创之前国内数据库格局也基本如此。SQL Server由于是window可用，不在讨论之列。Oracle、MySQL、PostgreSQL在国内数据库有着绝对统治地位，国产数据库也大多兼容其中一种或多种，三者的区别也代表了国产数据库区别
### 特性区别
#### SQL中的单双引号

|	| MySQL | PostgreSQL | Oracle |
| --------- |:-------------:|:---------|:--------|
| 单引号 | 表示值，用于字符串和日期 | 表示值，用于字符串 | 用于字符串或者转义
| 双引号 | 作用同单引号 | 用于标识表名或列名 | 用于字段名、schema、别名和关键字等。用双引号则严格区分大小写。|
| 反引号 | 用于标识表名或列名 | 无 | 无 | 
#### 空值
```
MySQL有null和''，而postgresql和Oracle则是null。
```

#### 大小写
```
MySQL大小写是不敏感的，不加``,对表名、字段名大小写都可以。

PostgreSQL对表名、字段名都是区分大小写。在SQL语句中对大小写是不敏感的，select ID from t_user 和 select id from t_user 都会从t_user这个表中查询id这个字段，如果要查询大写字母的字段，要加上双引号：select “ID” from t_user

Oracle大小写是敏感的。ORACLE 在建表/字段时，如果没有双引号， ORACLE 会把表名、字段名全部转化为大写字母，然后写入数据字典。访问数据字典时，没有双引号 ORACLE 会将其转化成大写然后再去数据字段中查找
```
<br>

### 简单的语句的区别
#### 分页查询
在 MySQL 中，可以使用 LIMIT 和 OFFSET 实现分页查询：
```
SELECT * FROM table_name LIMIT 10 OFFSET 20;
```
在 PostgreSQL 中，可以使用 LIMIT 和 OFFSET 或 FETCH 和 OFFSET 实现分页查询：
```
-- 使用 LIMIT 和 OFFSET
SELECT * FROM table_name LIMIT 10 OFFSET 20;

-- 使用 FETCH 和 OFFSET
SELECT * FROM table_name OFFSET 20 FETCH FIRST 10 ROWS ONLY;
```
在 Oracle 中，可以使用 ROWNUM 或 FETCH 和 OFFSET 实现分页查询：
```
-- 使用 ROWNUM（在 Oracle 12c 之前的版本）
SELECT * FROM (
  SELECT t.*, ROWNUM rn
  FROM table_name t
  WHERE ROWNUM <= 30
) WHERE rn > 20;

-- 使用 FETCH 和 OFFSET（从 Oracle 12c 开始支持）
SELECT * FROM table_name OFFSET 20 ROWS FETCH NEXT 10 ROWS ONLY;
```
#### 字符串连接
在 MySQL 中，可以使用 CONCAT 函数连接字符串：
```
SELECT CONCAT('Hello', ' ', 'World');
```
在 PostgreSQL 中，可以使用 || 运算符连接字符串：
```
SELECT 'Hello' || ' ' || 'World';
```
在 Oracle 中，可以使用 || 运算符连接字符串
```
SELECT 'Hello' || ' ' || 'World';
```
#### 创建自增主键
在 MySQL 中，可以使用 AUTO_INCREMENT 创建自增主键：
```
CREATE TABLE table_name (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255)
);
```
在 PostgreSQL 中，可以使用 SERIAL 或 IDENTITY 创建自增主键：
```
-- 使用 SERIAL
CREATE TABLE table_name (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255)
);

-- 使用 IDENTITY (从 PostgreSQL 10 开始支持)
CREATE TABLE table_name (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255)
);
```
在 Oracle 中，可以使用序列（Sequence）和触发器（Trigger）创建自增主键：
```
-- 创建序列
CREATE SEQUENCE table_name_seq;

-- 创建表
CREATE TABLE table_name (
    id NUMBER PRIMARY KEY,
    name VARCHAR2(255)
);

-- 创建触发器
CREATE OR REPLACE TRIGGER table_name_trg
BEFORE INSERT ON table_name FOR EACH ROW
BEGIN
  SELECT table_name_seq.NEXTVAL INTO :new.id FROM dual;
END;
```
从 Oracle 12c 开始，可以使用 IDENTITY 列创建自增主键：
```
CREATE TABLE table_name (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    name VARCHAR2(255)
);
```
#### 插入数据并返回自增主键值
在 MySQL 中，可以使用 LAST_INSERT_ID() 函数获取上一条插入记录的自增主键值：
```
INSERT INTO table_name (name) VALUES ('John Doe');
SELECT LAST_INSERT_ID();
```
在 PostgreSQL 中，可以使用 RETURNING 子句获取插入记录的自增主键值：
```
INSERT INTO table_name (name) VALUES ('John Doe') RETURNING id;
```
在 Oracle 中，可以使用 RETURNING 子句获取插入记录的自增主键值：
```
DECLARE
  last_id NUMBER;
BEGIN
  INSERT INTO table_name (name) VALUES ('John Doe') RETURNING id INTO last_id;
  -- 处理 last_id 变量，例如将其输出到客户端
END;
```

## 驱动连接
现代数据库系统驱动连接主要提供两种不同的方式。一种是针对开发语言的驱动链接，例如PHP的PDO，GO的Xorm，java的JDBC。一种是通用的数据库连接ODBC。Oracle、MySQL、PostgreSQL因为覆盖率高，对各种开发语言的驱动连接完善度很高， 国产数据库刚起步，相对不完善。国产数据库对Java的JDBC支持度最高，部分数据库提供PHP的PDO驱动，Go大多通过ODBC支持。

## PHP项目驱动连接流程
![os.png](images/php-db.jpg)

图中DB与业务强相关，MixphpEngine与业务无关。结合上述数据库区别，可以在MixphpEngine中统一处理单双引号，大小写，语句等差异问题。

### MixphpEngine处理方式
* 单个兼容，在单个Engine读取配置进行差异化改造;优点：架构改造少，集成度高，维护简单；缺点：兼容修改可能互相影响，测试工作量大
* 多个兼容，创建多个Engine，每个Engine负责一种数据库，通过配置加载不同的Engine。优点：修改互不影响，测试简单；缺点：架构改造大，维护工作量大

## Go项目驱动连接流程
![go-db.jpg](images/go-db.jpg)

大体与PHP类似，在Session中统一处理单双引号，大小写，语句等差异问题

## 达梦兼容
DM8是达梦公司在总结DM系列产品研发与应用经验的基础上，坚持开放创新、简洁实用的理念，推出的新一代自研数据库。

DM8兼容MySQL基础Sql语句，单双引号与MySQL一致，可配置大小写敏感，文本类型字段与MySQL所占空间不一样，MySQL 中 varchar(1) 可以存一个汉字，DM 数据库是以字节为单位。若是 gb18030 字符集，varchar(2) 才可以存一个汉字；若是 UTF-8 字符集，varchar(3) 才可以存一个汉字

MySQL迁移官方文档 https://eco.dameng.com/document/dm/zh-cn/start/MySQL_dm.html

MySQL迁移常见文档 https://eco.dameng.com/document/dm/zh-cn/faq/faq-mysql-dm8-migrate.html

驱动连接：DM8提供php的PDO驱动，Go结合Xorm通过ODBC进行连接